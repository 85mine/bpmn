<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Grande | Demo</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <link href="css/plugins/ladda/ladda-themeless.min.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

</head>

<body>

    <div id="wrapper">

        <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav metismenu" id="side-menu">
                    <li class="nav-header">
                        <div class="dropdown profile-element">
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                <span class="clear">
                                    <span class="block m-t-xs">
                                        <strong class="font-bold">David Williams</strong>
                                    </span>
                                    <span class="text-muted text-xs block">Art Director<b class="caret"></b></span>
                                </span>
                            </a>
                            <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                <li><a href="/login">Logout</a></li>
                            </ul>
                        </div>
                        <div class="logo-element">
                            IN+
                        </div>
                    </li>
                    <li>
                        <a href="/"><i class="fa fa-exclamation-circle"></i> <span class="nav-label">Khai báo lỗi</span></a>
                    </li>
                    <li>
                        <a href="/tasklist"><i class="fa fa-tasks"></i> <span class="nav-label">Danh sách lỗi</span> </a>
                    </li>
                </ul>

            </div>
        </nav>

        <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
                    <div class="navbar-header">
                        <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                    </div>
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <a href="/login">
                                <i class="fa fa-sign-out"></i> Log out
                            </a>
                        </li>
                    </ul>

                </nav>
            </div>
            <div class="wrapper wrapper-content animated fadeInRight">
                <form method="post">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="wrapper wrapper-content animated fadeInUp">
                                <div class="ibox">
                                    <div class="ibox-content">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="m-b-md">
                                                    <a href="#" class="btn btn-primary btn-xs pull-right" data-toggle="modal" data-target="#modal" id="task_name"></a>
                                                    <h3>Thông chi tiết lỗi <span class="label label-danger" id="task_description"></span></h3>
                                                </div>
                                                <!-- <dl class="dl-horizontal">
                                                    <dt>Trạng thái:</dt> <dd><span class="label label-primary"></span></dd>
                                                </dl> -->
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-5">
                                                <dl class="dl-horizontal">
                                                    <dt>Đơn hàng:</dt><dd id="order_id"></dd>
                                                    <dt>Căn hộ:</dt><dd id="apartment_id"></dd>
                                                </dl>
                                            </div>
                                            <div class="col-lg-7">
                                                <dl class="dl-horizontal" >
                                                    <dt>Sản phẩm:</dt><dd id="product_id"></dd>
                                                    <dt>Hộc tủ:</dt><dd id="drawer_id"></dd>
                                                    <dt>Chi tiết:</dt><dd id="accessories_id"></dd>
                                                </dl>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-5">
                                                <dl class="dl-horizontal">
                                                    <dt>Thông tin lỗi:</dt><dd id="issue_type"></dd>
                                                    <dt></dt><dd><textarea id="issue_type_description" disabled></textarea></dd>
                                                </dl>
                                            </div>
                                            <div class="col-lg-5">
                                                <dl class="dl-horizontal">
                                                    <dt>Cấp độ lỗi:</dt><dd id="issue_level"></dd>
                                                    <dt></dt><dd><textarea id="issue_level_description" disabled></textarea></dd>
                                                </dl>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="footer">
                <div>
                    <strong>Copyright</strong> Grande Company &copy; 2014-2017
                </div>
            </div>

            <div class="modal inmodal" id="modal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content animated bounceInRight">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                            <i class="fa fa-laptop modal-icon"></i>
                            <h4 class="modal-title">Xác nhận</h4>
                        </div>
                        <div class="modal-body">
                            <form>
                                <input name="task_id" id="task_id" class="hidden">
                                <div class="row">
                                    <div class="col-md-12">
                                        <label>Phân loại lỗi</label>
                                        <div class="radio radio-success">
                                            <input type="radio" name="issue_type" id="issue_type_1" value="1">
                                            <label for="issue_type_1">Sai kích thước</label>
                                        </div>
                                        <div class="radio radio-success">
                                            <input type="radio" name="issue_type" id="issue_type_2" value="2">
                                            <label for="issue_type_2">Thiết kế sai</label>
                                        </div>
                                        <div class="radio radio-success">
                                            <input type="radio" name="issue_type" id="issue_type_3" value="3">
                                            <label for="issue_type_3">Khảo sát sai</label>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <label>Phân cấp lỗi</label>
                                        <div class="radio radio-success">
                                            <input type="radio" name="issue_level" id="issue_level_1" value="1">
                                            <label for="issue_level_1">Lỗi loại 1</label>
                                        </div>
<!--                                         <div class="row">
                                            <div class="col-xs-12 col-xs-offset-1 col-md-12 col-md-offset-1">
                                                <div class="radio radio-info">
                                                    <input type="radio" name="issue_level_1_option" id="issue_level_1_option_1" value="0">
                                                    <label for="issue_level_1_option_1">Chủ động xử lý</label>
                                                </div>
                                                <div class="radio radio-info">
                                                    <input type="radio" name="issue_level_1_option" id="issue_level_1_option_2" value="1">
                                                    <label for="issue_level_1_option_2">Yêu cầu cấp vật tư</label>
                                                    <div class="row">
                                                        <div class="col-xs-12 col-xs-offset-1 col-md-12 col-md-offset-1">
                                                            <div class="radio radio-danger">
                                                                <input type="radio" name="issue_level_1_option2" id="issue_level_1_option2_0" value="0">
                                                                <label for="issue_level_1_option2_0">Không yêu cầu mua hàng</label>
                                                            </div>
                                                            <div class="radio radio-info">
                                                                <input type="radio" name="issue_level_1_option2" id="issue_level_1_option2_1" value="1">
                                                                <label for="issue_level_1_option2_1">Yêu cầu mua hàng</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div> -->
                                        <div class="radio radio-success">
                                            <input type="radio" name="issue_level" id="issue_level_2" value="2">
                                            <label for="issue_level_2">Lỗi loại 2</label>
                                        </div>
                                        <div class="radio radio-success">
                                            <input type="radio" name="issue_level" id="issue_level_3" value="3">
                                            <label for="issue_level_3">Lỗi loại 3</label>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-white" data-dismiss="modal">Đóng</button>
                            <button class="ladda-button btn btn-primary"  data-style="expand-left" type="submit">Lưu thay đổi</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- Ladda -->
    <script src="js/plugins/ladda/spin.min.js"></script>
    <script src="js/plugins/ladda/ladda.min.js"></script>
    <script src="js/plugins/ladda/ladda.jquery.min.js"></script>

    <script>

        $(document).ready(function (){
            function getUrlParams(elem) {
                var sPageURL = window.location.search.substring(1);
                var sURLVariables = sPageURL.split('&');
                for (var i = 0; i < sURLVariables.length; i++)
                {
                    var sParameterName = sURLVariables[i].split('=');
                    if (sParameterName[0] == elem)
                    {
                        return decodeURIComponent(sParameterName[1]);
                    }
                }
            }

            var task_id = getUrlParams("id");
            var url = "http://localhost:8080/api/v1/task/" + task_id;
            $.ajax({
                type: "GET",
                url: url,
                dataType: 'json',
                success: function(response)
                {

                    $("#task_description").html(response['task_description']);
                    $("#task_id").val(response['task_id']);
                    $("#task_name").html("<i class=\"fa fa-pencil\"></i> " + response['task_name']);
                    $("#order_id").html("ĐH-" + response['order_id']);
                    $("#apartment_id").html("CH-" + response['apartment_id']);
                    $("#product_id").html("SP-" + response['product_id']);
                    $("#drawer_id").html("HT-" + response['drawer_id']);
                    $("#accessories_id").html("CT-" + response['accessories_id']);

                    if(typeof($("input[name=issue_type]")[response["issue_type"] - 1]) != "undefined"){
                        $("input[name=issue_type]")[response["issue_type"] - 1].checked = true;
                    }

                    if(typeof($("input[name=issue_level]")[response["issue_level"] - 1]) != "undefined"){
                        $("input[name=issue_level]")[response["issue_level"] - 1].checked = true;
                    }

                    if(typeof($("input[name=issue_level_1_option]")[response["issue_level_1_option"] -1]) != "undefined"){
                        $("input[name=issue_level_1_option]")[response["issue_level_1_option"] -1].checked = true;
                    }

                    switch (response["issue_type"]) {
                        case "1":
                        $("#issue_type").html("Sai kích thước");
                        break;
                        case "2":
                        $("#issue_type").html("Thiết kế sai");
                        break;
                        case "3":
                        $("#issue_type").html("Khảo sát sai");
                        break;
                        default:
                        $("#issue_type").html("Không xác định");
                        break;
                    }

                    $("#issue_level").html("Lỗi loại " + response["issue_level"]);

                    switch (response["issue_level_1_option"]) {
                        case "1":
                        $("#issue_level_1_option").html("Chủ động xử lý");
                        break;
                        case "2":
                        $("#issue_level_1_option").html("Yêu cầu cấp vật tư");
                        break;
                    }

                    $("#issue_type_description").html(response["issue_type_description"]);
                    $("#issue_level_description").html(response["issue_level_description"]);

                    console.log(response);
                // response.forEach(parsePassHtml);
            }
            ,
            error: function(jqXHR, exception){
                console.error(jqXHR);
            }
        });

        // ------------------------- Update info ----------
        $.fn.serializeObject = function () {
            var o = {};
            var a = this.serializeArray();
            $.each(a, function () {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };

        var l = $( '.ladda-button' ).ladda();
        l.click(function(){
            l.ladda( 'start' );
            var serialize = $("form").serializeObject();
            var params = JSON.stringify(serialize);
            console.log(params);
            var url_post = "http://localhost:8080/api/v1/task/complete/" + task_id;
            return $.ajax({
                type: "POST",
                url: url_post,
                dataType: 'json',
                contentType: "application/json",
                data: params,
                success: function(response)
                {
                    window.location.href = "http://bpmn.com/tasklist";
                    console.log(response);
                }
                ,
                error: function(jqXHR, exception){
                    console.error(jqXHR);
                }
            }).done(function() {
                l.ladda('stop');
            });
        });

    });

</script>

</body>

</html>
